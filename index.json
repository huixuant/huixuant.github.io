[{"content":"\u003cp\u003eA while ago, I participated in GovTech\u0026rsquo;s \u003ca href=\"https://jts.tech.gov.sg/2022/stack-the-flags\"\u003eSTACK the Flags\u003c/a\u003e competition. One of the challenges I attempted was \u003cstrong\u003eHit You With That\u003c/strong\u003e, but I didn\u0026rsquo;t manage to solve it within the duration of the CTF.\nI gave it a second try after the competition ended, and managed to find the flag with a bit of help. As part of the learning process, here is my attempt at documenting the steps I took to discover the flag.\u003c/p\u003e\n\u003ch2 id=\"analysing-pcap-in-wireshark\"\u003eAnalysing PCAP in Wireshark\u003c/h2\u003e\n\u003cp\u003eOpening up the given PCAP file in Wireshark, the first thing I noticed was a series of TCP packets. Following the stream, it appears that a \u003ca href=\"https://youtu.be/IHNzOHi8sJs?t=70\"\u003eHTTP GET request\u003c/a\u003e is made. The link opens up to the music video of BlackPink\u0026rsquo;s Ddu-Du Ddu-Du (which, I suppose, explains the challenge title). However, there isn\u0026rsquo;t any other useful information.\u003c/p\u003e\n\u003cp\u003eNext, sorting the packets by protocol, I noticed that there seemed to be a large number of \u003cstrong\u003eICMP\u003c/strong\u003e packets that contained some sort of encoded data, which caught my interest.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/wireshark.png\" width=80%\u003e\u003c/img\u003e\u003c/p\u003e\n\u003ch2 id=\"extracting-packet-data-with-scapy\"\u003eExtracting Packet Data with Scapy\u003c/h2\u003e\n\u003cp\u003eUsing the \u003ca href=\"https://scapy.net/\"\u003escapy\u003c/a\u003e library, I wrote a simple Python script to exfiltrate the payload and dump it into a text file.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e scapy.all \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epcap \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e rdpcap(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;STF22.pcapng\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#75715e\"\u003e# reads pcap file \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elistbytes \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bytearray()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(len(pcap)):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e pcap[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehaslayer(ICMP) \u003cspan style=\"color:#f92672\"\u003eand\u003c/span\u003e pcap[i][IP]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edst \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;192.168.96.11\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        listbytes\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eextend(pcap[i]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eload)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;bytes.txt\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;wb\u0026#39;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(listbytes)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"decoding-payload\"\u003eDecoding Payload\u003c/h2\u003e\n\u003cp\u003eViewing the extracted data in its entirety, it becomes clear that the payload was Base64 encoded. Hence, I used \u003ca href=\"https://gchq.github.io/CyberChef/\"\u003eCyberchef\u003c/a\u003e and loaded the \u003cstrong\u003eFrom Base64\u003c/strong\u003e recipe to decode it. The output is a PNG file of BlackPink\u0026rsquo;s Pink Venom poster as seen below.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/poster.png\" width=50%\u003e\u003c/img\u003e\u003c/p\u003e\n\u003cp\u003eFinally, using the \u003cstrong\u003eStrings\u003c/strong\u003e recipe on Cyberchef gives us the flag we are looking for: \u003cmark\u003eSTF22{Bl@ckPin9_V3n0m}\u003c/mark\u003e.\u003c/p\u003e\n","description":"","image":null,"permalink":"https://hugo-profile.netlify.app/blog/stf22-writeup/","title":"STACK the Flags 2022: Hit You With That Challenge Writeup"}]